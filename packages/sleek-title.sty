\ProvidesPackage{sleek-title}[2021/04/08 v1.0 Sleek Title]

%%%%%%%%%%%%%%%%
% Requirements %
%%%%%%%%%%%%%%%%

\RequirePackage{geometry}
\RequirePackage{graphicx}
\RequirePackage[framemethod=TikZ]{mdframed}
\RequirePackage[nomessages]{fp}

%%%%%%%%%%%%
% Commands %
%%%%%%%%%%%%

% Auxiliary commands

\newcommand*{\clearpar}{\unskip\par} % or \unskip\strut\par

\newcommand*{\countlines}[1]{ % saves the number of lines of #1 in \numlines
    \setbox0\vbox{
        \noindent{#1}\par
        \count@\z@
        \loop
        \unskip\unpenalty\unskip\unpenalty\unskip
        \setbox0\lastbox
        \ifvoid0
           \xdef\numlines{\the\count@}
        \else
           \advance\count@\@ne
        \repeat
    }
}

\newcommand*{\adjustheight}{ % saves the height of the top and bottom mini-pages in \miniheight
    \countlines{\bfseries\huge\@title}
    \FPeval{\miniheight}{0.435 - 0.02 * (\numlines - 1)}
}

% Custom fields

\newif\ifLogo
\newif\ifInstitute
\newif\ifFaculty
\newif\ifDepartment
\newif\ifSubtitle
\newif\ifSupervisor
\newif\ifContext

\newcommand*{\logo}[1]{\gdef\@logo{#1}\Logotrue}
\newcommand*{\institute}[1]{\gdef\@institute{#1}\Institutetrue}
\newcommand*{\faculty}[1]{\gdef\@faculty{#1}\Facultytrue}
\newcommand*{\department}[1]{\gdef\@department{#1}\Departmenttrue}
\newcommand*{\subtitle}[1]{\gdef\@subtitle{#1}\Subtitletrue}
\newcommand*{\supervisor}[1]{\gdef\@supervisor{#1}\Supervisortrue}
\newcommand*{\context}[1]{\gdef\@context{#1}\Contexttrue}

%%%%%%%%%%%%%%
% Title-page %
%%%%%%%%%%%%%%

\renewcommand*{\maketitle}{%
    \adjustheight
    \newgeometry{margin = 2.5cm}
    \begin{titlepage}
        \setlength{\parindent}{0pt}
        \begin{minipage}[t][\miniheight\textheight]{\textwidth}
            \begin{center}
                \ifLogo
                    \includegraphics[height=0.15\textheight]{\@logo}
                \fi
                \vfill
                {\scshape\ifInstitute\LARGE\@institute\fi\ifFaculty\ifInstitute\\[0.125em]\fi\Large\@faculty\fi\ifDepartment\\[0.25em]\large\@department\fi\clearpar}
                \vfill
            \end{center}
        \end{minipage}
        \vfill
        \begin{minipage}{\textwidth}
            \begin{mdframed}[linewidth=2pt, innertopmargin=1.5em, innerbottommargin=1.5em, leftline=false, rightline=false]
                \begin{center}
                    {\bfseries\huge\@title\clearpar}
                \end{center}
            \end{mdframed}
        \end{minipage}
        \vfill
        \begin{minipage}[b][\miniheight\textheight][t]{\textwidth}
            \begin{center}
                \ifSubtitle
                    \begin{center}
                        {\Large\@subtitle\clearpar}
                    \end{center}
                \fi
                \vfill
                \ifSupervisor
                    \begin{minipage}[t]{0.49\textwidth}
                        {\large\@author\clearpar}
                    \end{minipage}
                    \begin{minipage}[t]{0.49\textwidth}
                        \begin{flushright}
                            {\large\@supervisor\clearpar}
                        \end{flushright}
                    \end{minipage}
                \else
                    {\large\@author\clearpar}
                \fi
                \vfill
                \ifContext
                    {\large\@context\par}
                \fi
                {\large\@date\par}
            \end{center}
        \end{minipage}
    \end{titlepage}
    \restoregeometry
}

\endinput
